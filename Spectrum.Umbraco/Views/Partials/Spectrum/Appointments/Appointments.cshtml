<h4>Appointments</h4>
<table id="appointmentsGrid" class="table table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th data-column-id="id" data-type="numeric" data-width="5%" data-header-align="center" data-align="center">Id</th>
            <th data-column-id="startTime" data-formatter="startTime" data-header-align="center" data-align="center">Start</th>
            <th data-column-id="endTime" data-formatter="endTime" data-header-align="center" data-align="center">End</th>
            <th data-column-id="status" data-header-align="center" data-align="center">Status</th>
            <th data-column-id="paymentId" data-header-align="center" data-align="center" data-formatter="paymentId">Payment Id</th>
            <th data-column-id="location" data-header-align="center" data-align="center">Location</th>
            <th data-column-id="description" data-header-align="center" data-align="center">Description</th>
            <th data-column-id="actions" data-header-align="center" data-align="center" data-formatter="actions">Commands</th>
        </tr>
    </thead>
</table>

<script>
    
    var appointmentsGrid = $("#appointmentsGrid").bootgrid({
        labels: {
            noResults: "No appointments found"
        },
        searchSettings: {
            delay: 100,
            characters: 1
        },
        ajax: true,
        url: "/umbraco/Surface/Appointments/GetBootGridAppointments",
        formatters: {
            "startTime": function(column, row) {
                return moment.utc(row.startTime).format('ddd DD MMM HH:mm');
            },
            "endTime": function (column, row) {
                return moment.utc(row.endTime).format('ddd DD MMM HH:mm');
            },
            "paymentId": function (column, row) {
                if (row.paymentId !== "") {
                    return '<a href="#" class="link-payment" data-payment-id=' + row.paymentId + '>' + row.paymentId + '</a>';
                }

                return '<a href="' + row.takePaymentUrl + '" style="color: red">Take Payment</a>';
            },
            "actions": function (column, row) {
                return '<a href="#" class="link-view-appointment" data-encrypted-appointment-id=' +
                    row.encryptedId +
                    '>View</a>' +
                    '&nbsp;|&nbsp;<a href="#" class="link-edit-appointment" data-encrypted-appointment-id=' +
                    row.encryptedId +
                    '>Edit</a>' +
                    '&nbsp;|&nbsp;<a href="#" class="link-delete-appointment" data-encrypted-appointment-id=' +
                    row.encryptedId +
                    '>Delete</a>';
            }
        }
    }).on("loaded.rs.jquery.bootgrid", function () {

        appointmentsGrid.find(".link-payment").on("click", function (e) {
            var transactionsId = $(this).data("payment-id");
            event.preventDefault();

            $.ajax({
                url: '/umbraco/Surface/Transactions/View/' + transactionsId,
                success: function (data) {
                    onTransaction(data);
                }
            });
        }).end().find(".link-view-appointment").on("click", function (e) {
            var appointmentId = $(this).data("encrypted-appointment-id");
            event.preventDefault();

            $.ajax({
                url: '/umbraco/Surface/Appointments/View/' + appointmentId,
                success: function (data) {
                    onViewAppointment(data);
                }
            });
        }).end().find(".link-edit-appointment").on("click", function (e) {
            var appointmentId = $(this).data("encrypted-appointment-id");
            event.preventDefault();

            $.ajax({
                url: '/umbraco/Surface/Appointments/Edit/' + appointmentId,
                success: function (data) {
                    onEditAppointment(data);
                }
            });
        });
    });
    
 </script>

    <div id="appointment"></div>

    <script type="text/javascript">

        window.confirm = function (message, callback, caption) {
            caption = caption || 'Confirmation';
            $(document.createElement('div')).attr({
                title: caption,
                'class': 'dialog'
            }).html(message).dialog({
                dialogClass: 'fixed',
                buttons: {
                    "OK": function () {
                        $(this).dialog('close');
                        callback();
                        return true;
                    },
                    "Cancel": function () {
                        $(this).dialog('close');
                        return false;
                    }
                },
                close: function () {
                    $(this).remove();
                },
                draggable: false,
                modal: true,
                resizable: false,
                width: 'auto'
            });
        };


        function onViewAppointment(data) {
            jQuery('#appointment').html(data);
            jQuery('#appointment').dialog({ 'title': 'View Appointment', 'width': 400, 'height': 300 });
            jQuery('#appointment').dialog().css("border-color", "blue");
        }

        function onEditAppointment(data) {
            jQuery('#appointment').html(data);
            jQuery('#appointment').dialog({ 'title': 'Edit Appointment', 'width': 400, 'height': 300 });
            jQuery('#appointment').dialog().css("border-color", "blue");
        }

        function onDeleteAppointment() {
            location.reload();
        }

    </script>


